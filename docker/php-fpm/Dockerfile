FROM php:8.4.11-fpm-alpine3.22

#--------------------------------------------------------------------------
# Alpine Linux packages
#--------------------------------------------------------------------------

RUN apk update \
#--------------------------------------------------------------------------
# PHP extensions
#--------------------------------------------------------------------------
 && apk add --no-cache --virtual .php-build-deps \
        autoconf \
        gcc \
        g++ \
        make \
        curl-dev \
        oniguruma-dev \
#####################################
# BC Math
# cURL
# MB String
# OPCache
# PDO
# PDO MySQL
##################################### \
 && docker-php-ext-install -j$(nproc) \
     bcmath \
     curl \
     mbstring \
     opcache \
     pdo \
     pdo_mysql \
#####################################
# APCu
#####################################
 && pecl install apcu \
 && docker-php-ext-enable apcu \
#------
# done
#------
 && apk del .php-build-deps \
#--------------------------------------------------------------------------
# cleanup
#--------------------------------------------------------------------------
 && rm -rf /tmp/* /var/tmp/*

#--------------------------------------------------------------------------
# PHP conf
#--------------------------------------------------------------------------

COPY ./conf.d/* /usr/local/etc/php/conf.d/

#--------------------------------------------------------------------------
# PHP-FPM conf
#--------------------------------------------------------------------------

COPY ./php-fpm.d/* /usr/local/etc/php-fpm.d/

#--------------------------------------------------------------------------
# Environment
#--------------------------------------------------------------------------

VOLUME /src

ENV LANG="C.UTF-8"
ENV LC_ALL="C.UTF-8"
ENV TZ="UTC"

WORKDIR /src

#--------------------------------------------------------------------------
# Final Touch
#--------------------------------------------------------------------------

EXPOSE 9000
